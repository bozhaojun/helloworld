var $ = require('jquery')

var tbody =
	'<table class="table table-striped table-bordered table-hover dataTable" id="comp-table" >' +
		'<thead>' +
			'<tr>' +
				'<th style="width:8%;">竞品名称</th>' +
				'<th style="width:4%;">波动情况</th>' +
			'</tr>' +
		'</thead>' +
		'<tbody></tbody>' +
	'</table>'

var columnDefs = [
		{
			// 竞品名称
			className:'digit-center',
			data: 'ITEM_NAME',
			targets: 0
		}, {
			// 波动情况
			className:'digit-center',
			data: 'RATE',
			targets: 1,
		},
		{
			"orderable": false,
			"targets": [0, 1]
		}]

exports.init = function( ccomId, packbar, month ) {
	$('#detail-cont').html(tbody)
	var tableHeigth = Math.max($(document).height() - 560, 371)
	var _table = $('#comp-table').on( 'processing.dt', function ( e, settings, processing ) { 			
			if( processing ){ 				
				$('#detail-cont').scmrLoading() 			
			}else{ 				
				$('#detail-cont').unScmrLoading() 			
			}
		}).DataTable({
			"info": false,
		ajax:{
			url: 'dealitemorderwave.cmd?method=getCompItemInfo',
			type: 'POST',
			data: function(d) {
				d.month = month,
				d.packbar = packbar,
				d.comId = ccomId
			}
		},
		
		columnDefs: columnDefs,
		paging: false,
		scrollY: tableHeigth + 'px',
		order: [[1, 'desc']]
	})
		
	$('#search-btn').on('click', function() {
		$('#detail-cont').hide();
	})
	
}
